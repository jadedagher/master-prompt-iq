# Fork & Setup Guide

Step-by-step instructions to get your own copy of this project running.

## Prerequisites

- **Node.js** >= 18.18 and **npm** >= 9
- **Python** >= 3.11 (for the local dev backend)
- An **OpenAI account** with API access
- A **Vercel account** (for deployment)

## 1. Fork & Clone

```bash
# Fork this repo on GitHub, then:
git clone https://github.com/<your-username>/openai-chatkit-starter-app.git
cd openai-chatkit-starter-app
```

## 2. Install Dependencies

```bash
npm install                          # root deps
cd managed-chatkit && npm install    # backend orchestrator (concurrently)
cd frontend && npm install           # React frontend
cd ../..                             # back to root
```

## 3. Set Up Environment Variables

Create two `.env.local` files — one at the project root and one inside `managed-chatkit/`:

### Root `.env.local`

```
OPENAI_API_KEY=sk-proj-YOUR_KEY_HERE
VERCEL_OIDC_TOKEN=eyJ...          # only needed for Vercel deployment
VITE_CHATKIT_DOMAIN_PK=domain_pk_YOUR_KEY_HERE
VITE_CHATKIT_WORKFLOW_ID=wf_YOUR_ID_HERE
```

### `managed-chatkit/.env.local`

```
OPENAI_API_KEY=sk-proj-YOUR_KEY_HERE
VITE_CHATKIT_DOMAIN_PK=domain_pk_YOUR_KEY_HERE
VITE_CHATKIT_WORKFLOW_ID=wf_YOUR_ID_HERE
```

> Both files are git-ignored and will never be committed.

---

## 4. How to Get Each Credential

### `OPENAI_API_KEY`

Your OpenAI API secret key. This is used server-side to create ChatKit sessions.

1. Go to [platform.openai.com/api-keys](https://platform.openai.com/api-keys)
2. Click **"Create new secret key"**
3. Copy the key (starts with `sk-proj-...`)
4. Paste it into both `.env.local` files

> The key must belong to the same organization/project that owns your ChatKit workflow.

### `VITE_CHATKIT_WORKFLOW_ID`

The ID of your ChatKit workflow (the AI agent configuration). Starts with `wf_...`.

1. Go to [platform.openai.com](https://platform.openai.com) and open **Agent Builder**
2. Create a new workflow or open an existing one
3. Copy the workflow ID from the URL or the workflow settings panel — it looks like `wf_698c7ecf...`

### `VITE_CHATKIT_DOMAIN_PK`

The public domain key that identifies your ChatKit integration. Starts with `domain_pk_...`.

1. In **Agent Builder**, go to your workflow's **Deploy** or **ChatKit** settings
2. Find the domain public key — it looks like `domain_pk_698c8dbb...`
3. This is a public key (safe to expose in frontend code) that scopes the chat widget to your domain

### `VERCEL_OIDC_TOKEN`

This is an **OpenID Connect token** automatically generated by Vercel. It proves to external services that a request is coming from your specific Vercel project/deployment. **You do NOT need to create this manually** — it is generated for you.

**For local development:** You don't need this token. The local backend (`managed-chatkit/backend`) handles session creation directly using your `OPENAI_API_KEY`.

**For Vercel deployment:**

1. Install the Vercel CLI: `npm i -g vercel`
2. Link your project: `vercel link`
3. Pull environment variables: `vercel env pull .env.local`
4. Vercel will auto-populate `VERCEL_OIDC_TOKEN` in the `.env.local` it generates
5. On deployed Vercel functions, the token is injected automatically at runtime — you never need to set it manually in the Vercel dashboard

> The OIDC token is short-lived (expires in ~12 hours). If your local `.env.local` has a stale one from `vercel env pull`, just re-run the pull command to refresh it. In production on Vercel, it auto-refreshes on every request.

---

## 5. Run Locally

### Managed ChatKit (recommended)

```bash
cd managed-chatkit
npm run dev
```

This starts both:
- **FastAPI backend** on `http://127.0.0.1:8000` (handles session creation)
- **Vite dev server** on `http://localhost:5173` (React frontend, proxies `/api/*` to the backend)

### Deploy to Vercel

```bash
vercel link          # link to your Vercel project
vercel env pull      # pull env vars (creates .env.local)
vercel deploy        # deploy to preview
vercel --prod        # deploy to production
```

Make sure to add these environment variables in your **Vercel project dashboard** under Settings > Environment Variables:
- `OPENAI_API_KEY`
- `VITE_CHATKIT_WORKFLOW_ID`
- `VITE_CHATKIT_DOMAIN_PK`

> `VERCEL_OIDC_TOKEN` is injected by Vercel automatically — do **not** add it manually in the dashboard.

---

## 6. Project Structure

```
├── api/
│   └── create-session.js      # Vercel serverless function (session creation)
├── managed-chatkit/
│   ├── backend/                # FastAPI backend (local dev only)
│   ├── frontend/               # Vite + React + ChatKit UI
│   └── .env.local              # Local env vars (git-ignored)
├── chatkit/                    # Self-hosted ChatKit example (alternative)
├── vercel.json                 # Vercel build & function config
└── .env.local                  # Root env vars (git-ignored)
```

## 7. Customization

- **UI**: Edit `managed-chatkit/frontend/src/components/ChatKitPanel.tsx`
- **Session logic**: Edit `managed-chatkit/backend/app/main.py` (local) or `api/create-session.js` (Vercel)
- **Theme/branding**: Modify the `options` object in `ChatKitPanel.tsx` (colors, typography, greeting text)
